<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job Details</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #121212;
            color: #e0e0e0;
        }

        h1 {
            color: #f5f5f5;
            border-bottom: 2px solid #f5f5f5;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        p {
            margin-bottom: 10px;
        }

        .container {
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }

        .job-info strong {
            display: inline-block;
            width: 150px;
            color: #b0bec5;
        }

        .gemini-results, .performance-metrics {
            background-color: #2c2c2c;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #333;
            margin-bottom: 20px;
        }

        .result-section {
            margin-bottom: 20px;
        }

        .result-section h4 {
            color: #81d4fa;
            margin-top: 0;
        }

        .result-section ul {
            padding-left: 20px;
        }

        pre {
            white-space: pre-wrap;
            background-color: #37474f;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #455a64;
            color: #eceff1;
        }

        a {
            color: #81d4fa;
            text-decoration: none;
        }

        a:hover {
            text-decoration: underline;
        }

        .back-link {
            display: inline-block;
            margin-top: 20px;
            padding: 10px 15px;
            background-color: #81d4fa;
            color: #121212;
            border-radius: 5px;
            font-weight: bold;
        }

        .back-link:hover {
            background-color: #4fc3f7;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>{{ job['job_title'] }}</h1>
        <div class="job-info">
            <p><strong>Description:</strong> {{ job['job_description'] }}</p>
            <p><strong>Budget:</strong> {{ job['budget'] }}</p>
            <p><strong>Email Date:</strong> {{ job['email_date'] }}</p>
            <p><strong>Status:</strong> {{ job['status'] }}</p>
        </div>
        
        <h3>Gemini Results:</h3>
        <div class="gemini-results">
            <!-- Parse Budget Section -->
            {% if 'parse_budget' in job['gemini_results'] %}
            <div class="result-section">
                <h4>Parse Budget:</h4>
                <ul>
                    <li><strong>Rate Type:</strong> {{ job['gemini_results']['parse_budget']['rate_type'] }}</li>
                    <li><strong>Max Budget (CAD):</strong> {{ job['gemini_results']['parse_budget']['max_budget_cad'] }}</li>
                    <li><strong>Min Budget (CAD):</strong> {{ job['gemini_results']['parse_budget']['min_budget_cad'] }}</li>
                </ul>
            </div>
            {% endif %}

            <!-- Analyze Job Fit Section -->
            {% if 'analyze_job_fit' in job['gemini_results'] %}
            <div class="result-section">
                <h4>Analyze Job Fit:</h4>
                <p><strong>Fit:</strong> {{ job['gemini_results']['analyze_job_fit']['fit'] }}</p>
                <p><strong>Reasons:</strong> {{ job['gemini_results']['analyze_job_fit']['reasons'] }}</p>
            </div>
            {% endif %}

            <!-- Summarize Analysis Section -->
            {% if 'summarize_analysis' in job['gemini_results'] %}
            <div class="result-section">
                <h4>Summarize Analysis:</h4>
                <p><strong>Assumptions:</strong> {{ job['gemini_results']['summarize_analysis']['assumptions'] }}</p>
                <p><strong>Total Estimated Time:</strong> {{ job['gemini_results']['summarize_analysis']['total_estimated_time'] }}</p>
                {% if job['gemini_results']['summarize_analysis']['additional_considerations'] %}
                <p><strong>Additional Considerations:</strong> {{ job['gemini_results']['summarize_analysis']['additional_considerations'] }}</p>
                {% endif %}
            </div>
            {% endif %}

            <!-- Generate Detailed Steps Section -->
            {% if 'generate_detailed_steps' in job['gemini_results'] %}
            <div class="result-section">
                <h4>Generate Detailed Steps:</h4>
                <ul>
                    {% for step in job['gemini_results']['generate_detailed_steps'].get('steps', []) %}
                    <li>
                        <strong>{{ step.get('title', 'No title') }}:</strong>
                        <div>{{ step.get('description', 'No description') | safe }}</div>
                        <p><strong>Estimated Time:</strong> {{ step.get('estimatedTime', 'No estimated time') }}</p>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Generate Application Letter Section -->
            {% if 'generate_application_letter' in job['gemini_results'] %}
            <div class="result-section">
                <h4>Generate Application Letter:</h4>
                <p><strong>Introduction:</strong> {{ job['gemini_results']['generate_application_letter'].get('introduction', 'No introduction') | safe }}</p>
                <p><strong>Fit:</strong> {{ job['gemini_results']['generate_application_letter'].get('fit', 'No fit information') | safe }}</p>
                <p><strong>Approach:</strong> {{ job['gemini_results']['generate_application_letter'].get('approach', 'No approach information') | safe }}</p>
                <p><strong>Closing:</strong> {{ job['gemini_results']['generate_application_letter'].get('closing', 'No closing information') | safe }}</p>
            </div>
            {% endif %}

        <h3>Performance Metrics:</h3>
        <div class="performance-metrics">
            {{ job['performance_metrics'] | tojson(indent=2) }}
        </div>
        
        <a href="{{ url_for('index') }}" class="back-link">Back to list</a>
    </div>
</body>
</html>
