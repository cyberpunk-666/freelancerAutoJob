{% extends "layout.html" %}

{% block title %}Job Details{% endblock %}

{% block content %}
<div class="container">
    <h1>{{ job['job_title'] }}</h1>
    
    <!-- Job Info Section -->
    <div class="card">
        <h4>Job Overview</h4>
        <p><strong>Description:</strong> {{ job['job_description'] }}</p>
        <p><strong>Budget:</strong> {{ job['budget'] }}</p>
        <p><strong>Email Date:</strong> {{ job['email_date'] }}</p>
        <p><strong>Status:</strong> {{ job['status'] }}</p>
    </div>
    
    <!-- Gemini Results Section -->
    <h3>Gemini Results:</h3>
    <div class="gemini-results">
        <!-- Parse Budget Section -->
        {% if 'parse_budget' in job['gemini_results'] %}
        <div class="card">
            <h4>Parse Budget</h4>
            <ul>
                <li><strong>Rate Type:</strong> {{ job['gemini_results']['parse_budget']['rate_type'] }}</li>
                <li><strong>Max Budget (CAD):</strong> {{ job['gemini_results']['parse_budget']['max_budget_cad'] }}</li>
                <li><strong>Min Budget (CAD):</strong> {{ job['gemini_results']['parse_budget']['min_budget_cad'] }}</li>
            </ul>
        </div>
        {% endif %}

        <!-- Analyze Job Fit Section -->
        {% if 'analyze_job_fit' in job['gemini_results'] %}
        <div class="card">
            <h4>Analyze Job Fit</h4>
            <p><strong>Fit:</strong> {{ job['gemini_results']['analyze_job_fit']['fit'] }}</p>
            <p><strong>Reasons:</strong> {{ job['gemini_results']['analyze_job_fit']['reasons'] }}</p>
        </div>
        {% endif %}

        <!-- Generate Detailed Steps Section -->
        {% if 'generate_detailed_steps' in job['gemini_results'] %}
        <div class="card">
            <h4>Generate Detailed Steps</h4>
            <ul>
                {% for step in job['gemini_results']['generate_detailed_steps'].get('steps', []) %}
                <li>
                    <strong>{{ step.get('title', 'No title') }}:</strong>
                    <div>{{ step.get('description', 'No description') | safe }}</div>
                    <p><strong>Estimated Time:</strong> {{ step.get('estimatedTime', 'No estimated time') }}</p>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- Summarize Analysis Section -->
        {% if 'summarize_analysis' in job['gemini_results'] %}
        <div class="card">
            <h4>Summarize Analysis</h4>
            <p><strong>Assumptions:</strong> {{ job['gemini_results']['summarize_analysis']['assumptions'] }}</p>
            <p><strong>Total Estimated Time:</strong> {{ job['gemini_results']['summarize_analysis']['total_estimated_time'] }}</p>
            {% if job['gemini_results']['summarize_analysis']['additional_considerations'] %}
            <p><strong>Additional Considerations:</strong> {{ job['gemini_results']['summarize_analysis']['additional_considerations'] }}</p>
            {% endif %}
        </div>
        {% endif %}

        <!-- Generate Application Letter Section -->
        {% if 'generate_application_letter' in job['gemini_results'] %}
        <div class="card">
            <h4>Generate Application Letter</h4>
            <p><strong>Introduction:</strong> {{ job['gemini_results']['generate_application_letter'].get('introduction', 'No introduction') | safe }}</p>
            <p><strong>Fit:</strong> {{ job['gemini_results']['generate_application_letter'].get('fit', 'No fit information') | safe }}</p>
            <p><strong>Approach:</strong> {{ job['gemini_results']['generate_application_letter'].get('approach', 'No approach information') | safe }}</p>
            <p><strong>Closing:</strong> {{ job['gemini_results']['generate_application_letter'].get('closing', 'No closing information') | safe }}</p>
        </div>
        {% endif %}
    </div>

    <!-- Performance Metrics Section -->
    <h3>Performance Metrics:</h3>
    <div class="card">
        <pre>{{ job['performance_metrics'] | tojson(indent=2) }}</pre>
    </div>
    
    <!-- Navigation Link -->
    <a href="{{ url_for('jobs.index') }}" class="back-link">Back to list</a>
</div>
{% endblock %}
